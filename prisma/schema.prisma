generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                 String           @unique
  username              String           @unique
  password              String
  email_verified        Boolean?         @default(false)
  display_name          String?
  avatar                String?
  bio                   String?
  location              String?
  website               String?
  birth_date            DateTime?        @db.Timestamp(6)
  theme                 String?          @default("dark")
  language              String?          @default("en")
  notifications_enabled Boolean?         @default(true)
  email_notifications   Boolean?         @default(true)
  role                  user_role?       @default(USER)
  status                user_status?     @default(ACTIVE)
  is_creator            Boolean?         @default(false)
  created_at            DateTime?        @default(now()) @db.Timestamp(6)
  updated_at            DateTime?        @default(now()) @db.Timestamp(6)
  deleted_at            DateTime?        @db.Timestamp(6)
  version               Int?             @default(0)
  account_deletions     AccountDeletion?
  user_preferences      UserPreferences?

  @@index([created_at], map: "idx_users_created_at")
  @@index([deleted_at], map: "idx_users_deleted_at")
  @@index([email], map: "idx_users_email")
  @@index([id, created_at], map: "idx_users_id_created_at")
  @@index([username], map: "idx_users_username")
  @@map("users")
}

model Creator {
  id                      String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                 String          @unique @db.Uuid
  display_name            String
  handle                  String          @unique
  avatar                  String?
  banner                  String?
  bio                     String?
  location                String?
  website                 String?
  is_verified             Boolean?        @default(false)
  verified_at             DateTime?       @db.Timestamp(6)
  verification_badge      String?
  follower_count          Int?            @default(0)
  following_count         Int?            @default(0)
  content_count           Int?            @default(0)
  total_views             BigInt?         @default(0)
  total_likes             Int?            @default(0)
  total_comments          Int?            @default(0)
  is_monetized            Boolean?        @default(false)
  monetization_enabled_at DateTime?       @db.Timestamp(6)
  payout_email            String?
  payout_method           String?
  status                  creator_status? @default(PENDING)
  created_at              DateTime?       @default(now()) @db.Timestamp(6)
  updated_at              DateTime?       @default(now()) @db.Timestamp(6)
  deleted_at              DateTime?       @db.Timestamp(6)
  version                 Int?            @default(0)
  content                 Content[]

  @@index([created_at], map: "idx_creators_created_at")
  @@index([deleted_at], map: "idx_creators_deleted_at")
  @@index([handle], map: "idx_creators_handle")
  @@index([is_verified], map: "idx_creators_is_verified")
  @@index([status], map: "idx_creators_status")
  @@index([user_id], map: "idx_creators_user_id")
  @@index([user_id, created_at], map: "idx_creators_user_created")
  @@map("creators")
}

model Content {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creatorId      String          @map("creator_id") @db.Uuid
  title          String
  description    String?
  type           content_type
  status         content_status? @default(DRAFT)
  thumbnail      String?
  thumbnailBlur  String?         @map("thumbnail_blur") // Base64 blur placeholder
  mediaUrl       String          @map("media_url")
  mediaType      String?         @map("media_type")
  duration       Int?
  fileSize       BigInt?         @map("file_size")
  resolution     String?
  isVR           Boolean?        @default(false) @map("is_vr")
  viewCount      Int?            @default(0) @map("view_count")
  likeCount      Int?            @default(0) @map("like_count")
  commentCount   Int?            @default(0) @map("comment_count")
  shareCount     Int?            @default(0) @map("share_count")
  isPublic       Boolean?        @default(true) @map("is_public")
  isNSFW         Boolean?        @default(false) @map("is_nsfw")
  ageRestricted  Boolean?        @default(false) @map("age_restricted")
  allowComments  Boolean?        @default(true) @map("allow_comments")
  allowDownloads Boolean?        @default(false) @map("allow_downloads")
  isPremium      Boolean?        @default(false) @map("is_premium")
  price          Decimal?        @db.Decimal(10, 2)
  currency       String?         @default("USD")
  publishedAt    DateTime?       @map("published_at") @db.Timestamp(6)
  scheduledAt    DateTime?       @map("scheduled_at") @db.Timestamp(6)
  createdAt      DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime?       @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt      DateTime?       @map("deleted_at") @db.Timestamp(6)
  version        Int?            @default(0)
  content_flags  ContentFlag[]
  creator        Creator         @relation(fields: [creatorId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([status], map: "idx_content_status")
  @@index([type], map: "idx_content_type")
  @@index([creatorId], map: "idx_content_creator")
  @@index([creatorId, viewCount], map: "idx_content_creator_views")
  @@index([creatorId, publishedAt], map: "idx_content_creator_published")
  @@index([publishedAt], map: "idx_content_published_at")
  @@index([publishedAt, status], map: "idx_content_published_status")
  @@index([viewCount], map: "idx_content_view_count")
  @@index([likeCount], map: "idx_content_like_count")
  @@map("content")
}

model Category {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String    @unique
  slug        String    @unique
  description String?
  icon        String?
  color       String?
  is_active   Boolean?  @default(true)
  sort_order  Int?      @default(0)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
  deleted_at  DateTime? @db.Timestamp(6)

  @@index([slug], map: "idx_categories_slug")
  @@map("categories")
}

model Tag {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String    @unique
  slug        String    @unique
  usage_count Int?      @default(0)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)

  @@index([slug], map: "idx_tags_slug")
  @@index([usage_count], map: "idx_tags_usage_count")
  @@map("tags")
}

model ContentCategory {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId  String    @map("content_id") @db.Uuid
  categoryId String    @map("category_id") @db.Uuid
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([contentId, categoryId], map: "content_categories_unique")
  @@index([categoryId], map: "idx_content_categories_category")
  @@index([contentId], map: "idx_content_categories_content")
  @@index([categoryId, createdAt], map: "idx_content_categories_category_created")
  @@map("content_categories")
}

model ContentTag {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId String    @map("content_id") @db.Uuid
  tagId     String    @map("tag_id") @db.Uuid
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([contentId, tagId], map: "content_tags_unique")
  @@index([contentId], map: "idx_content_tags_content")
  @@index([tagId], map: "idx_content_tags_tag")
  @@map("content_tags")
}

model CreatorCategory {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creatorId  String    @map("creator_id") @db.Uuid
  categoryId String    @map("category_id") @db.Uuid
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([creatorId, categoryId], map: "creator_categories_unique")
  @@index([categoryId], map: "idx_creator_categories_category")
  @@index([creatorId], map: "idx_creator_categories_creator")
  @@map("creator_categories")
}

model View {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId String    @map("content_id") @db.Uuid
  userId    String?   @map("user_id") @db.Uuid
  ipAddress String?   @map("ip_address")
  userAgent String?   @map("user_agent")
  duration  Int?
  watchedAt DateTime? @default(now()) @map("watched_at") @db.Timestamp(6)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@index([contentId], map: "idx_views_content")
  @@index([contentId, createdAt], map: "idx_views_content_created")
  @@index([userId], map: "idx_views_user")
  @@index([userId, createdAt], map: "idx_views_user_created")
  @@index([watchedAt], map: "idx_views_watched_at")
  @@map("views")
}

model Like {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId String    @map("content_id") @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([contentId, userId], map: "likes_unique")
  @@index([contentId], map: "idx_likes_content")
  @@index([createdAt], map: "idx_likes_created_at")
  @@index([userId], map: "idx_likes_user")
  @@index([userId, createdAt], map: "idx_likes_user_created")
  @@map("likes")
}

model Comment {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId  String    @map("content_id") @db.Uuid
  userId     String    @map("user_id") @db.Uuid
  text       String
  parentId   String?   @map("parent_id") @db.Uuid
  likes      Int?      @default(0)
  isEdited   Boolean?  @default(false) @map("is_edited")
  is_deleted Boolean?  @default(false)
  deletedAt  DateTime? @map("deleted_at") @db.Timestamp(6)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt  DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  version    Int?      @default(0)
  dislikes   Int?      @default(0)
  isPinned   Boolean?  @default(false) @map("is_pinned")

  @@map("comments")
}

model CommentLike {
  id        String    @id @default(cuid()) @db.Uuid
  commentId String    @map("comment_id") @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  type      String
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([commentId, userId])
  @@index([commentId], map: "idx_comment_likes_comment_id")
  @@index([userId], map: "idx_comment_likes_user_id")
  @@map("comment_likes")
}

model UserPreferences {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id               String    @unique @db.Uuid
  theme                 String?   @default("auto")
  language              String?   @default("en")
  region                String?
  hide_history          Boolean?  @default(false)
  anonymous_mode        Boolean?  @default(false)
  allow_personalization Boolean?  @default(true)
  show_activity_status  Boolean?  @default(true)
  allow_messages        String?   @default("everyone")
  show_watch_history    String?   @default("private")
  show_playlists        String?   @default("public")
  show_liked_content    String?   @default("private")
  history_lock_enabled  Boolean?  @default(false)
  history_lock_pin_hash String?
  default_quality       String?   @default("auto")
  autoplay              Boolean?  @default(true)
  notifications         Json?     @default("{\"push\": {}, \"email\": {}, \"inApp\": {}}")
  created_at            DateTime? @default(now()) @db.Timestamp(6)
  updated_at            DateTime? @default(now()) @db.Timestamp(6)
  users                 User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_preferences_user_id")
  @@map("user_preferences")
}

model AccountDeletion {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String    @unique @db.Uuid
  requested_at  DateTime? @default(now()) @db.Timestamp(6)
  scheduled_for DateTime  @db.Timestamp(6)
  reason        String?
  status        String?   @default("pending")
  completed_at  DateTime? @db.Timestamp(6)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  users         User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([scheduled_for], map: "idx_account_deletions_scheduled_for")
  @@index([status], map: "idx_account_deletions_status")
  @@index([user_id], map: "idx_account_deletions_user_id")
  @@map("account_deletions")
}

model Playlist {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id     String    @db.Uuid
  name        String
  description String?
  thumbnail   String?
  is_public   Boolean?  @default(false)
  sort_order  Int?      @default(0)
  item_count  Int?      @default(0)
  view_count  Int?      @default(0)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
  deleted_at  DateTime? @db.Timestamp(6)
  version     Int?      @default(0)

  @@index([is_public], map: "idx_playlists_is_public")
  @@index([user_id], map: "idx_playlists_user")
  @@index([user_id, created_at], map: "idx_playlists_user_created")
  @@map("playlists")
}

model PlaylistItem {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  playlist_id String    @db.Uuid
  content_id  String    @db.Uuid
  sort_order  Int?      @default(0)
  added_at    DateTime? @default(now()) @db.Timestamp(6)

  @@unique([playlist_id, content_id], map: "playlist_items_unique")
  @@index([content_id], map: "idx_playlist_items_content")
  @@index([playlist_id], map: "idx_playlist_items_playlist")
  @@index([playlist_id, sort_order], map: "idx_playlist_items_playlist_order")
  @@map("playlist_items")
}

model Subscription {
  id            String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  subscriber_id String               @db.Uuid
  creator_id    String               @db.Uuid
  tier          subscription_tier?   @default(BASIC)
  status        subscription_status? @default(ACTIVE)
  is_recurring  Boolean?             @default(true)
  amount        Decimal              @db.Decimal(10, 2)
  currency      String?              @default("USD")
  interval      String?              @default("monthly")
  started_at    DateTime?            @default(now()) @db.Timestamp(6)
  expires_at    DateTime?            @db.Timestamp(6)
  canceled_at   DateTime?            @db.Timestamp(6)
  renewed_at    DateTime?            @db.Timestamp(6)
  created_at    DateTime?            @default(now()) @db.Timestamp(6)
  updated_at    DateTime?            @default(now()) @db.Timestamp(6)
  version       Int?                 @default(0)

  @@unique([subscriber_id, creator_id], map: "subscriptions_unique")
  @@index([creator_id], map: "idx_subscriptions_creator")
  @@index([status], map: "idx_subscriptions_status")
  @@index([subscriber_id], map: "idx_subscriptions_subscriber")
  @@index([subscriber_id, created_at], map: "idx_subscriptions_subscriber_created")
  @@map("subscriptions")
}

model Transaction {
  id              String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String              @db.Uuid
  subscription_id String?             @db.Uuid
  type            transaction_type
  status          transaction_status? @default(PENDING)
  amount          Decimal             @db.Decimal(10, 2)
  currency        String?             @default("USD")
  payment_method  String?
  payment_id      String?
  receipt_url     String?
  description     String?
  metadata        Json?
  created_at      DateTime?           @default(now()) @db.Timestamp(6)
  updated_at      DateTime?           @default(now()) @db.Timestamp(6)
  version         Int?                @default(0)

  @@index([status], map: "idx_transactions_status")
  @@index([subscription_id], map: "idx_transactions_subscription")
  @@index([type], map: "idx_transactions_type")
  @@index([user_id], map: "idx_transactions_user")
  @@index([user_id, created_at], map: "idx_transactions_user_created")
  @@map("transactions")
}

model Notification {
  id         String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String            @db.Uuid
  type       notification_type
  title      String
  message    String
  link       String?
  is_read    Boolean?          @default(false)
  read_at    DateTime?         @db.Timestamp(6)
  metadata   Json?
  created_at DateTime?         @default(now()) @db.Timestamp(6)

  @@index([is_read], map: "idx_notifications_is_read")
  @@index([user_id], map: "idx_notifications_user")
  @@index([user_id, created_at], map: "idx_notifications_user_created")
  @@index([user_id, is_read], map: "idx_notifications_user_read")
  @@map("notifications")
}

model Report {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  reporter_id      String         @db.Uuid
  reported_user_id String?        @db.Uuid
  content_id       String?        @db.Uuid
  type             report_type
  reason           String
  status           report_status? @default(PENDING)
  moderator_id     String?        @db.Uuid
  moderator_notes  String?
  resolved_at      DateTime?      @db.Timestamp(6)
  created_at       DateTime?      @default(now()) @db.Timestamp(6)
  updated_at       DateTime?      @default(now()) @db.Timestamp(6)
  version          Int?           @default(0)
  content_type     String?        @default("content")
  target_id        String?        @db.Uuid
  description      String?
  reviewed_by      String?        @db.Uuid
  reviewed_at      DateTime?      @db.Timestamp(6)
  action           String?

  @@index([content_id], map: "idx_reports_content")
  @@index([created_at], map: "idx_reports_created_at")
  @@index([reported_user_id], map: "idx_reports_reported_user")
  @@index([reporter_id], map: "idx_reports_reporter")
  @@index([status], map: "idx_reports_status")
  @@map("reports")
}

model ContentFlag {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content_id  String    @db.Uuid
  flag_type   String
  reason      String
  severity    String
  is_active   Boolean?  @default(true)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  resolved_at DateTime? @db.Timestamp(6)
  content     Content   @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([content_id, flag_type, reason], map: "content_flags_unique")
  @@map("content_flags")
}

enum UserRole {
  USER
  CREATOR
  MODERATOR
  ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  BANNED
  INACTIVE
}

enum CreatorStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum ContentType {
  VIDEO
  PHOTO
  VR
  LIVE_STREAM
  AUDIO
}

enum ContentStatus {
  DRAFT
  PENDING_REVIEW
  PUBLISHED
  ARCHIVED
  REJECTED
  DELETED
}

enum SubscriptionTier {
  BASIC
  PREMIUM
  VIP
  CUSTOM
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
  PENDING
  FAILED
}

enum TransactionType {
  SUBSCRIPTION
  TIP
  PREMIUM_CONTENT
  REFUND
  WITHDRAWAL
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  CANCELED
}

enum NotificationType {
  NEW_FOLLOWER
  NEW_COMMENT
  NEW_LIKE
  NEW_SUBSCRIBER
  CONTENT_APPROVED
  CONTENT_REJECTED
  PAYMENT_RECEIVED
  SYSTEM_ANNOUNCEMENT
  MENTION
  MESSAGE
}

enum ReportType {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  COPYRIGHT_VIOLATION
  FAKE_ACCOUNT
  OTHER
}

enum ReportStatus {
  PENDING
  UNDER_REVIEW
  RESOLVED
  DISMISSED
  ACTION_TAKEN
}

enum content_status {
  DRAFT
  PENDING_REVIEW
  PUBLISHED
  ARCHIVED
  REJECTED
  DELETED
}

enum content_type {
  VIDEO
  PHOTO
  VR
  LIVE_STREAM
  AUDIO
}

enum creator_status {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum notification_type {
  NEW_FOLLOWER
  NEW_COMMENT
  NEW_LIKE
  NEW_SUBSCRIBER
  CONTENT_APPROVED
  CONTENT_REJECTED
  PAYMENT_RECEIVED
  SYSTEM_ANNOUNCEMENT
  MENTION
  MESSAGE
}

enum report_status {
  PENDING
  UNDER_REVIEW
  RESOLVED
  DISMISSED
  ACTION_TAKEN
}

enum report_type {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  COPYRIGHT_VIOLATION
  FAKE_ACCOUNT
  OTHER
}

enum subscription_status {
  ACTIVE
  CANCELED
  EXPIRED
  PENDING
  FAILED
}

enum subscription_tier {
  BASIC
  PREMIUM
  VIP
  CUSTOM
}

enum transaction_status {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  CANCELED
}

enum transaction_type {
  SUBSCRIPTION
  TIP
  PREMIUM_CONTENT
  REFUND
  WITHDRAWAL
}

enum user_role {
  USER
  CREATOR
  MODERATOR
  ADMIN
}

enum user_status {
  ACTIVE
  SUSPENDED
  BANNED
  INACTIVE
}
