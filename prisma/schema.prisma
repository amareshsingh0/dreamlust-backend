generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                   String                   @unique
  username                String                   @unique
  password                String
  email_verified          Boolean?                 @default(false)
  display_name            String?
  avatar                  String?
  bio                     String?
  location                String?
  website                 String?
  birth_date              DateTime?                @db.Timestamp(6)
  theme                   String?                  @default("dark")
  language                String?                  @default("en")
  notifications_enabled   Boolean?                 @default(true)
  email_notifications     Boolean?                 @default(true)
  role                    user_role?               @default(USER)
  status                  user_status?             @default(ACTIVE)
  is_creator              Boolean?                 @default(false)
  balance                 Decimal?                 @default(0) @db.Decimal(10, 2)
  created_at              DateTime?                @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                @default(now()) @db.Timestamp(6)
  deleted_at              DateTime?                @db.Timestamp(6)
  version                 Int?                     @default(0)
  account_deletions       AccountDeletion?
  user_preferences        UserPreferences?
  user_subscriptions      UserSubscription[]
  loyalty                 UserLoyalty?
  loyaltyTransactions     LoyaltyTransaction[]
  analyticsEvents         AnalyticsEvent[]
  affiliate               Affiliate?
  referrals               Referral[]
  notificationPreferences NotificationPreferences?
  pushSubscriptions       PushSubscription[]
  feedback                Feedback[]
  savedSearches           SavedSearch[]
  searchHistory           SearchHistory[]
  collaborations          Collaboration[]
  followers               Follow[]       @relation("Follower")
  following               Follow[]       @relation("Following")
  activityFeed            ActivityFeed[]
  collections             Collection[]
  tips_given              Tip[]          @relation("TipsGiven")

  @@index([created_at], map: "idx_users_created_at")
  @@index([deleted_at], map: "idx_users_deleted_at")
  @@index([email], map: "idx_users_email")
  @@index([id, created_at], map: "idx_users_id_created_at")
  @@index([username], map: "idx_users_username")
  @@map("users")
}

model Creator {
  id                      String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                 String           @unique @db.Uuid
  display_name            String
  handle                  String           @unique
  avatar                  String?
  banner                  String?
  bio                     String?
  location                String?
  website                 String?
  is_verified             Boolean?         @default(false)
  verified_at             DateTime?        @db.Timestamp(6)
  verification_badge      String?
  follower_count          Int?             @default(0)
  following_count         Int?             @default(0)
  content_count           Int?             @default(0)
  total_views             BigInt?          @default(0)
  total_likes             Int?             @default(0)
  total_comments          Int?             @default(0)
  is_monetized            Boolean?         @default(false)
  monetization_enabled_at DateTime?        @db.Timestamp(6)
  payout_email            String?
  payout_method           String?
  stripe_account_id       String?          @map("stripe_account_id") // Connected Stripe account for payouts (legacy)
  razorpay_account_id     String?          @map("razorpay_account_id") // Connected Razorpay account for payouts
  status                  creator_status?  @default(PENDING)
  created_at              DateTime?        @default(now()) @db.Timestamp(6)
  updated_at              DateTime?        @default(now()) @db.Timestamp(6)
  deleted_at              DateTime?        @db.Timestamp(6)
  version                 Int?             @default(0)
  content                 Content[]
  live_streams            LiveStream[]
  subscriptions           Subscription[]
  creator_earnings        CreatorEarnings?
  tips_received           Tip[]

  @@index([created_at], map: "idx_creators_created_at")
  @@index([deleted_at], map: "idx_creators_deleted_at")
  @@index([handle], map: "idx_creators_handle")
  @@index([is_verified], map: "idx_creators_is_verified")
  @@index([status], map: "idx_creators_status")
  @@index([user_id], map: "idx_creators_user_id")
  @@index([user_id, created_at], map: "idx_creators_user_created")
  @@map("creators")
}

model Content {
  id             String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creatorId      String            @map("creator_id") @db.Uuid
  title          String
  description    String?
  type           content_type
  status         content_status?   @default(DRAFT)
  thumbnail      String?
  thumbnailBlur  String?           @map("thumbnail_blur") // Base64 blur placeholder
  mediaUrl       String            @map("media_url")
  mediaType      String?           @map("media_type")
  duration       Int?
  fileSize       BigInt?           @map("file_size")
  resolution     String?
  isVR           Boolean?          @default(false) @map("is_vr")
  viewCount      Int?              @default(0) @map("view_count")
  likeCount      Int?              @default(0) @map("like_count")
  commentCount   Int?              @default(0) @map("comment_count")
  shareCount     Int?              @default(0) @map("share_count")
  isPublic       Boolean?          @default(true) @map("is_public")
  isNSFW         Boolean?          @default(false) @map("is_nsfw")
  ageRestricted  Boolean?          @default(false) @map("age_restricted")
  allowComments  Boolean?          @default(true) @map("allow_comments")
  allowDownloads Boolean?          @default(false) @map("allow_downloads")
  isPremium      Boolean?          @default(false) @map("is_premium")
  price          Decimal?          @db.Decimal(10, 2)
  currency       String?           @default("USD")
  publishedAt    DateTime?         @map("published_at") @db.Timestamp(6)
  scheduledAt    DateTime?         @map("scheduled_at") @db.Timestamp(6)
  createdAt      DateTime?         @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt      DateTime?         @map("deleted_at") @db.Timestamp(6)
  version        Int?              @default(0)
  content_flags  ContentFlag[]
  scheduledContent ScheduledContent?
  thumbnailTest   ThumbnailTest?
  collaborations  Collaboration[]
  collectionItems CollectionItem[]
  creator        Creator           @relation(fields: [creatorId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  views          View[]
  categories     ContentCategory[]
  tags           ContentTag[]
  likes          Like[]

  @@index([status], map: "idx_content_status")
  @@index([type], map: "idx_content_type")
  @@index([creatorId], map: "idx_content_creator")
  @@index([creatorId, viewCount], map: "idx_content_creator_views")
  @@index([creatorId, publishedAt], map: "idx_content_creator_published")
  @@index([publishedAt], map: "idx_content_published_at")
  @@index([publishedAt, status], map: "idx_content_published_status")
  @@index([viewCount], map: "idx_content_view_count")
  @@index([likeCount], map: "idx_content_like_count")
  @@map("content")
}

model Category {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String            @unique
  slug        String            @unique
  description String?
  icon        String?
  color       String?
  is_active   Boolean?          @default(true)
  sort_order  Int?              @default(0)
  created_at  DateTime?         @default(now()) @db.Timestamp(6)
  updated_at  DateTime?         @default(now()) @db.Timestamp(6)
  deleted_at  DateTime?         @db.Timestamp(6)
  contents    ContentCategory[]

  @@index([slug], map: "idx_categories_slug")
  @@map("categories")
}

model Tag {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String       @unique
  slug        String       @unique
  usage_count Int?         @default(0)
  created_at  DateTime?    @default(now()) @db.Timestamp(6)
  updated_at  DateTime?    @default(now()) @db.Timestamp(6)
  contents    ContentTag[]

  @@index([slug], map: "idx_tags_slug")
  @@index([usage_count], map: "idx_tags_usage_count")
  @@map("tags")
}

model ContentCategory {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId  String    @map("content_id") @db.Uuid
  categoryId String    @map("category_id") @db.Uuid
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  content    Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)
  category   Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([contentId, categoryId], map: "content_categories_unique")
  @@index([categoryId], map: "idx_content_categories_category")
  @@index([contentId], map: "idx_content_categories_content")
  @@index([categoryId, createdAt], map: "idx_content_categories_category_created")
  @@map("content_categories")
}

model ContentTag {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId String    @map("content_id") @db.Uuid
  tagId     String    @map("tag_id") @db.Uuid
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  content   Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)
  tag       Tag       @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([contentId, tagId], map: "content_tags_unique")
  @@index([contentId], map: "idx_content_tags_content")
  @@index([tagId], map: "idx_content_tags_tag")
  @@map("content_tags")
}

model CreatorCategory {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creatorId  String    @map("creator_id") @db.Uuid
  categoryId String    @map("category_id") @db.Uuid
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([creatorId, categoryId], map: "creator_categories_unique")
  @@index([categoryId], map: "idx_creator_categories_category")
  @@index([creatorId], map: "idx_creator_categories_creator")
  @@map("creator_categories")
}

model View {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId String    @map("content_id") @db.Uuid
  userId    String?   @map("user_id") @db.Uuid
  ipAddress String?   @map("ip_address")
  userAgent String?   @map("user_agent")
  duration  Int?
  watchedAt DateTime? @default(now()) @map("watched_at") @db.Timestamp(6)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  content   Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId], map: "idx_views_content")
  @@index([contentId, createdAt], map: "idx_views_content_created")
  @@index([userId], map: "idx_views_user")
  @@index([userId, createdAt], map: "idx_views_user_created")
  @@index([watchedAt], map: "idx_views_watched_at")
  @@map("views")
}

model Like {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId String    @map("content_id") @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  content   Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([contentId, userId], map: "likes_unique")
  @@index([contentId], map: "idx_likes_content")
  @@index([createdAt], map: "idx_likes_created_at")
  @@index([userId], map: "idx_likes_user")
  @@index([userId, createdAt], map: "idx_likes_user_created")
  @@map("likes")
}

model Comment {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId  String    @map("content_id") @db.Uuid
  userId     String    @map("user_id") @db.Uuid
  text       String
  parentId   String?   @map("parent_id") @db.Uuid
  likes      Int?      @default(0)
  isEdited   Boolean?  @default(false) @map("is_edited")
  is_deleted Boolean?  @default(false)
  deletedAt  DateTime? @map("deleted_at") @db.Timestamp(6)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt  DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  version    Int?      @default(0)
  dislikes   Int?      @default(0)
  isPinned   Boolean?  @default(false) @map("is_pinned")

  @@map("comments")
}

model CommentLike {
  id        String    @id @default(cuid()) @db.Uuid
  commentId String    @map("comment_id") @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  type      String
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([commentId, userId])
  @@index([commentId], map: "idx_comment_likes_comment_id")
  @@index([userId], map: "idx_comment_likes_user_id")
  @@map("comment_likes")
}

model UserPreferences {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id               String    @unique @db.Uuid
  theme                 String?   @default("auto")
  language              String?   @default("en")
  region                String?
  hide_history          Boolean?  @default(false)
  anonymous_mode        Boolean?  @default(false)
  allow_personalization Boolean?  @default(true)
  show_activity_status  Boolean?  @default(true)
  allow_messages        String?   @default("everyone")
  show_watch_history    String?   @default("private")
  show_playlists        String?   @default("public")
  show_liked_content    String?   @default("private")
  history_lock_enabled  Boolean?  @default(false)
  history_lock_pin_hash String?
  default_quality       String?   @default("auto")
  autoplay              Boolean?  @default(true)
  notifications         Json?     @default("{\"push\": {}, \"email\": {}, \"inApp\": {}}")
  created_at            DateTime? @default(now()) @db.Timestamp(6)
  updated_at            DateTime? @default(now()) @db.Timestamp(6)
  users                 User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_preferences_user_id")
  @@map("user_preferences")
}

model AccountDeletion {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String    @unique @db.Uuid
  requested_at  DateTime? @default(now()) @db.Timestamp(6)
  scheduled_for DateTime  @db.Timestamp(6)
  reason        String?
  status        String?   @default("pending")
  completed_at  DateTime? @db.Timestamp(6)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  users         User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([scheduled_for], map: "idx_account_deletions_scheduled_for")
  @@index([status], map: "idx_account_deletions_status")
  @@index([user_id], map: "idx_account_deletions_user_id")
  @@map("account_deletions")
}

model Playlist {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id     String    @db.Uuid
  name        String
  description String?
  thumbnail   String?
  is_public   Boolean?  @default(false)
  sort_order  Int?      @default(0)
  item_count  Int?      @default(0)
  view_count  Int?      @default(0)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
  deleted_at  DateTime? @db.Timestamp(6)
  version     Int?      @default(0)

  @@index([is_public], map: "idx_playlists_is_public")
  @@index([user_id], map: "idx_playlists_user")
  @@index([user_id, created_at], map: "idx_playlists_user_created")
  @@map("playlists")
}

model PlaylistItem {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  playlist_id String    @db.Uuid
  content_id  String    @db.Uuid
  sort_order  Int?      @default(0)
  added_at    DateTime? @default(now()) @db.Timestamp(6)

  @@unique([playlist_id, content_id], map: "playlist_items_unique")
  @@index([content_id], map: "idx_playlist_items_content")
  @@index([playlist_id], map: "idx_playlist_items_playlist")
  @@index([playlist_id, sort_order], map: "idx_playlist_items_playlist_order")
  @@map("playlist_items")
}

model Follow {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  followerId          String    @map("follower_id") @db.Uuid
  followingId         String    @map("following_id") @db.Uuid
  followingType       String    @default("user") @map("following_type") // creator, user
  notificationsEnabled Boolean? @default(true) @map("notifications_enabled")
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  follower            User      @relation("Follower", fields: [followerId], references: [id], onDelete: Cascade)
  following           User      @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId], map: "follows_unique")
  @@index([followerId], map: "idx_follows_follower")
  @@index([followingId], map: "idx_follows_following")
  @@map("follows")
}

model ActivityFeed {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  actorId     String    @map("actor_id") @db.Uuid
  type        String    // upload, like, comment, follow, playlist_create, collection_create
  targetType  String    @map("target_type") // content, playlist, user, collection
  targetId    String    @map("target_id") @db.Uuid
  metadata    Json?
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt], map: "idx_activity_feed_user_created")
  @@index([actorId], map: "idx_activity_feed_actor")
  @@index([targetType, targetId], map: "idx_activity_feed_target")
  @@map("activity_feed")
}

model Collection {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  description     String?
  ownerId         String            @map("owner_id") @db.Uuid
  isPublic        Boolean?          @default(true) @map("is_public")
  isCollaborative Boolean?         @default(false) @map("is_collaborative")
  contributors    String[]          // User IDs who can add
  followers       Int?              @default(0)
  thumbnailUrl    String?           @map("thumbnail_url")
  createdAt       DateTime?         @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  owner           User              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  items           CollectionItem[]

  @@index([isPublic, followers], map: "idx_collections_public_followers")
  @@index([ownerId], map: "idx_collections_owner")
  @@index([isCollaborative], map: "idx_collections_collaborative")
  @@map("collections")
}

model CollectionItem {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  collectionId String   @map("collection_id") @db.Uuid
  contentId    String   @map("content_id") @db.Uuid
  addedById    String   @map("added_by_id") @db.Uuid
  position     Int?      @default(0)
  note         String?  // Personal note about why added
  addedAt      DateTime? @default(now()) @map("added_at") @db.Timestamp(6)
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  content      Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([collectionId, contentId], map: "collection_items_unique")
  @@index([collectionId, position], map: "idx_collection_items_collection_position")
  @@index([contentId], map: "idx_collection_items_content")
  @@map("collection_items")
}

model Subscription {
  id            String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  subscriber_id String               @db.Uuid
  creator_id    String               @db.Uuid
  tier          subscription_tier?   @default(BASIC)
  status        subscription_status? @default(ACTIVE)
  is_recurring  Boolean?             @default(true)
  amount        Decimal              @db.Decimal(10, 2)
  currency      String?              @default("USD")
  interval      String?              @default("monthly")
  started_at    DateTime?            @default(now()) @db.Timestamp(6)
  expires_at    DateTime?            @db.Timestamp(6)
  canceled_at   DateTime?            @db.Timestamp(6)
  renewed_at    DateTime?            @db.Timestamp(6)
  created_at    DateTime?            @default(now()) @db.Timestamp(6)
  updated_at    DateTime?            @default(now()) @db.Timestamp(6)
  version       Int?                 @default(0)
  creator       Creator              @relation(fields: [creator_id], references: [id], onDelete: Cascade)

  @@unique([subscriber_id, creator_id], map: "subscriptions_unique")
  @@index([creator_id], map: "idx_subscriptions_creator")
  @@index([status], map: "idx_subscriptions_status")
  @@index([subscriber_id], map: "idx_subscriptions_subscriber")
  @@index([subscriber_id, created_at], map: "idx_subscriptions_subscriber_created")
  @@map("subscriptions")
}

model Transaction {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String              @db.Uuid
  subscription_id   String?             @db.Uuid
  type              transaction_type
  status            transaction_status? @default(PENDING)
  amount            Decimal             @db.Decimal(10, 2)
  currency          String?             @default("USD")
  payment_method    String?
  payment_id        String?
  stripe_payment_id String?             @map("stripe_payment_id") // Stripe payment intent/charge ID
  receipt_url       String?
  description       String?
  metadata          Json?
  created_at        DateTime?           @default(now()) @db.Timestamp(6)
  updated_at        DateTime?           @default(now()) @db.Timestamp(6)
  version           Int?                @default(0)

  @@index([status], map: "idx_transactions_status")
  @@index([subscription_id], map: "idx_transactions_subscription")
  @@index([type], map: "idx_transactions_type")
  @@index([user_id], map: "idx_transactions_user")
  @@index([user_id, created_at], map: "idx_transactions_user_created")
  @@map("transactions")
}

model Notification {
  id         String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String            @db.Uuid
  type       notification_type
  title      String
  message    String
  link       String?
  is_read    Boolean?          @default(false)
  read_at    DateTime?         @db.Timestamp(6)
  metadata   Json?
  created_at DateTime?         @default(now()) @db.Timestamp(6)

  @@index([is_read], map: "idx_notifications_is_read")
  @@index([user_id], map: "idx_notifications_user")
  @@index([user_id, created_at], map: "idx_notifications_user_created")
  @@index([user_id, is_read], map: "idx_notifications_user_read")
  @@map("notifications")
}

model Report {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  reporter_id      String         @db.Uuid
  reported_user_id String?        @db.Uuid
  content_id       String?        @db.Uuid
  type             report_type
  reason           String
  status           report_status? @default(PENDING)
  moderator_id     String?        @db.Uuid
  moderator_notes  String?
  resolved_at      DateTime?      @db.Timestamp(6)
  created_at       DateTime?      @default(now()) @db.Timestamp(6)
  updated_at       DateTime?      @default(now()) @db.Timestamp(6)
  version          Int?           @default(0)
  content_type     String?        @default("content")
  target_id        String?        @db.Uuid
  description      String?
  reviewed_by      String?        @db.Uuid
  reviewed_at      DateTime?      @db.Timestamp(6)
  action           String?

  @@index([content_id], map: "idx_reports_content")
  @@index([created_at], map: "idx_reports_created_at")
  @@index([reported_user_id], map: "idx_reports_reported_user")
  @@index([reporter_id], map: "idx_reports_reporter")
  @@index([status], map: "idx_reports_status")
  @@map("reports")
}

model ContentFlag {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content_id  String    @db.Uuid
  flag_type   String
  reason      String
  severity    String
  is_active   Boolean?  @default(true)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  resolved_at DateTime? @db.Timestamp(6)
  content     Content   @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([content_id, flag_type, reason], map: "content_flags_unique")
  @@map("content_flags")
}

model ScheduledContent {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId           String    @unique @map("content_id") @db.Uuid
  publishAt           DateTime  @map("publish_at") @db.Timestamp(6)
  status              String    @default("scheduled") // scheduled, published, failed
  notifyFollowers     Boolean?  @default(true) @map("notify_followers")
  socialMediaCrosspost Json?    @map("social_media_crosspost") // {twitter: true, instagram: true}
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt           DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  content             Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([publishAt, status], map: "idx_scheduled_content_publish_status")
  @@index([status], map: "idx_scheduled_content_status")
  @@map("scheduled_content")
}

model ThumbnailTest {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId   String    @unique @map("content_id") @db.Uuid
  variants    Json      // [{url: '...', impressions: 0, clicks: 0}]
  status      String    @default("running") // running, completed, paused
  winner      String?
  startedAt   DateTime? @default(now()) @map("started_at") @db.Timestamp(6)
  endedAt     DateTime? @map("ended_at") @db.Timestamp(6)
  content     Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([status], map: "idx_thumbnail_test_status")
  @@map("thumbnail_tests")
}

model Collaboration {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contentId     String    @map("content_id") @db.Uuid
  ownerId       String    @map("owner_id") @db.Uuid
  collaborators Json      // [{userId, role: 'editor' | 'viewer', permissions: []}]
  status        String    @default("active") // active, archived
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  content       Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)
  owner         User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([contentId], map: "idx_collaborations_content")
  @@index([ownerId], map: "idx_collaborations_owner")
  @@index([status], map: "idx_collaborations_status")
  @@map("collaborations")
}

enum UserRole {
  USER
  CREATOR
  MODERATOR
  ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  BANNED
  INACTIVE
}

enum CreatorStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum ContentType {
  VIDEO
  PHOTO
  VR
  LIVE_STREAM
  AUDIO
}

enum ContentStatus {
  DRAFT
  PENDING_REVIEW
  PUBLISHED
  ARCHIVED
  REJECTED
  DELETED
}

enum SubscriptionTier {
  BASIC
  PREMIUM
  VIP
  CUSTOM
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
  PENDING
  FAILED
}

enum TransactionType {
  SUBSCRIPTION
  TIP
  PREMIUM_CONTENT
  REFUND
  WITHDRAWAL
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  CANCELED
}

enum NotificationType {
  NEW_FOLLOWER
  NEW_COMMENT
  NEW_LIKE
  NEW_SUBSCRIBER
  CONTENT_APPROVED
  CONTENT_REJECTED
  PAYMENT_RECEIVED
  SYSTEM_ANNOUNCEMENT
  MENTION
  MESSAGE
}

enum ReportType {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  COPYRIGHT_VIOLATION
  FAKE_ACCOUNT
  OTHER
}

enum ReportStatus {
  PENDING
  UNDER_REVIEW
  RESOLVED
  DISMISSED
  ACTION_TAKEN
}

enum content_status {
  DRAFT
  PENDING_REVIEW
  PUBLISHED
  ARCHIVED
  REJECTED
  DELETED
}

enum content_type {
  VIDEO
  PHOTO
  VR
  LIVE_STREAM
  AUDIO
}

enum creator_status {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum notification_type {
  NEW_FOLLOWER
  NEW_COMMENT
  NEW_LIKE
  NEW_SUBSCRIBER
  NEW_UPLOAD
  CONTENT_APPROVED
  CONTENT_REJECTED
  PAYMENT_RECEIVED
  SYSTEM_ANNOUNCEMENT
  MENTION
  MESSAGE
}

enum report_status {
  PENDING
  UNDER_REVIEW
  RESOLVED
  DISMISSED
  ACTION_TAKEN
}

enum report_type {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  COPYRIGHT_VIOLATION
  FAKE_ACCOUNT
  OTHER
}

enum subscription_status {
  ACTIVE
  CANCELED
  EXPIRED
  PENDING
  FAILED
}

enum subscription_tier {
  BASIC
  PREMIUM
  VIP
  CUSTOM
}

enum transaction_status {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  CANCELED
}

enum transaction_type {
  SUBSCRIPTION
  TIP
  PREMIUM_CONTENT
  REFUND
  WITHDRAWAL
}

enum user_role {
  USER
  CREATOR
  MODERATOR
  ADMIN
}

enum user_status {
  ACTIVE
  SUSPENDED
  BANNED
  INACTIVE
}

model LiveStream {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creator_id        String            @db.Uuid
  title             String
  description       String?
  thumbnail_url     String?           @map("thumbnail_url")
  stream_key        String            @unique @map("stream_key")
  playback_url      String?           @map("playback_url")
  status            String            @default("idle") // idle, live, ended
  viewer_count      Int               @default(0) @map("viewer_count")
  peak_viewer_count Int               @default(0) @map("peak_viewer_count")
  started_at        DateTime?         @map("started_at") @db.Timestamp(6)
  ended_at          DateTime?         @map("ended_at") @db.Timestamp(6)
  scheduled_for     DateTime?         @map("scheduled_for") @db.Timestamp(6)
  category          String?
  tags              String[]
  is_recorded       Boolean           @default(true) @map("is_recorded")
  recording_url     String?           @map("recording_url")
  chat_enabled      Boolean           @default(true) @map("chat_enabled")
  created_at        DateTime          @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at        DateTime          @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  creator           Creator           @relation(fields: [creator_id], references: [id], onDelete: Cascade)
  chat_messages     LiveChatMessage[]

  @@index([creator_id, status], map: "idx_live_streams_creator_status")
  @@index([status, started_at], map: "idx_live_streams_status_started")
  @@map("live_streams")
}

model LiveChatMessage {
  id         String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  stream_id  String     @map("stream_id") @db.Uuid
  user_id    String     @map("user_id") @db.Uuid
  message    String
  timestamp  DateTime   @default(now()) @db.Timestamp(6)
  is_deleted Boolean    @default(false) @map("is_deleted")
  stream     LiveStream @relation(fields: [stream_id], references: [id], onDelete: Cascade)

  @@index([stream_id, timestamp], map: "idx_live_chat_stream_timestamp")
  @@map("live_chat_messages")
}

model UserSubscription {
  id                       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                  String    @db.Uuid
  plan                     String // basic, premium, creator
  status                   String    @default("active") // active, canceled, expired
  stripe_subscription_id   String?   @unique @map("stripe_subscription_id") // Legacy Stripe
  razorpay_subscription_id String?   @unique @map("razorpay_subscription_id") // Razorpay subscription ID
  current_period_start     DateTime? @map("current_period_start") @db.Timestamp(6)
  current_period_end       DateTime? @map("current_period_end") @db.Timestamp(6)
  cancel_at_period_end     Boolean   @default(false) @map("cancel_at_period_end")
  created_at               DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at               DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user                     User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, plan], map: "user_subscriptions_unique")
  @@index([user_id], map: "idx_user_subscriptions_user")
  @@index([status], map: "idx_user_subscriptions_status")
  @@map("user_subscriptions")
}

model CreatorEarnings {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creator_id          String    @unique @db.Uuid
  balance             Decimal   @default(0) @db.Decimal(10, 2)
  lifetime_earnings   Decimal   @default(0) @map("lifetime_earnings") @db.Decimal(10, 2)
  pending_payout      Decimal   @default(0) @map("pending_payout") @db.Decimal(10, 2)
  last_payout_at      DateTime? @map("last_payout_at") @db.Timestamp(6)
  stripe_account_id   String?   @map("stripe_account_id") // Connected Stripe account for payouts (legacy)
  razorpay_account_id String?   @map("razorpay_account_id") // Connected Razorpay account for payouts
  created_at          DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at          DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  creator             Creator   @relation(fields: [creator_id], references: [id], onDelete: Cascade)

  @@index([creator_id], map: "idx_creator_earnings_creator")
  @@map("creator_earnings")
}

model GiftCard {
  id              String    @id @default(cuid())
  code            String    @unique
  amount          Decimal   @db.Decimal(10, 2)
  currency        String    @default("USD")
  purchasedBy     String?   @map("purchased_by") @db.Uuid
  redeemedBy      String?   @map("redeemed_by") @db.Uuid
  status          String    @default("active") // active, redeemed, expired
  expiresAt       DateTime  @map("expires_at") @db.Timestamp(6)
  redeemedAt      DateTime? @map("redeemed_at") @db.Timestamp(6)
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  recipientEmail  String?   @map("recipient_email")
  personalMessage String?   @map("personal_message") @db.Text
  sendDate        DateTime? @map("send_date") @db.Timestamp(6)

  @@index([code], map: "idx_gift_cards_code")
  @@index([status], map: "idx_gift_cards_status")
  @@index([purchasedBy], map: "idx_gift_cards_purchased_by")
  @@index([redeemedBy], map: "idx_gift_cards_redeemed_by")
  @@map("gift_cards")
}

model UserLoyalty {
  userId         String   @unique @map("user_id") @db.Uuid
  points         Int      @default(0)
  tier           String   @default("bronze") // bronze, silver, gold, platinum
  lifetimePoints Int      @default(0) @map("lifetime_points")
  lastActivityAt DateTime @default(now()) @map("last_activity_at") @db.Timestamp(6)
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tier], map: "idx_user_loyalty_tier")
  @@index([points], map: "idx_user_loyalty_points")
  @@map("user_loyalty")
}

model LoyaltyTransaction {
  id        String   @id @default(cuid())
  userId    String   @map("user_id") @db.Uuid
  type      String // earned, redeemed
  points    Int
  reason    String // watch_time, referral, daily_login, purchase, reward_redemption, etc.
  metadata  Json?
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt], map: "idx_loyalty_transactions_user_created")
  @@index([type], map: "idx_loyalty_transactions_type")
  @@index([reason], map: "idx_loyalty_transactions_reason")
  @@map("loyalty_transactions")
}

model Reward {
  id          String    @id @default(cuid())
  title       String
  description String    @db.Text
  pointsCost  Int       @map("points_cost")
  type        String // discount, badge, feature_unlock, content_access
  value       Json // Discount percentage, badge image, feature name, content ID, etc.
  isActive    Boolean   @default(true) @map("is_active")
  stock       Int? // Null = unlimited
  imageUrl    String?   @map("image_url")
  category    String? // discount, badge, feature, content
  expiresAt   DateTime? @map("expires_at") @db.Timestamp(6)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([isActive, pointsCost], map: "idx_rewards_active_cost")
  @@index([type], map: "idx_rewards_type")
  @@index([category], map: "idx_rewards_category")
  @@map("rewards")
}

model AnalyticsEvent {
  id        String   @id @default(cuid())
  userId    String?  @map("user_id") @db.Uuid
  sessionId String   @map("session_id")
  eventType String   @map("event_type") // page_view, video_play, search, click, purchase, etc.
  eventData Json     @map("event_data")
  device    String
  browser   String
  os        String
  country   String?
  city      String?
  referrer  String?
  timestamp DateTime @default(now()) @db.Timestamp(6)
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId, timestamp], map: "idx_analytics_events_user_timestamp")
  @@index([eventType, timestamp], map: "idx_analytics_events_type_timestamp")
  @@index([sessionId], map: "idx_analytics_events_session")
  @@index([timestamp], map: "idx_analytics_events_timestamp")
  @@map("analytics_events")
}

model DailyStats {
  date               DateTime @unique @db.Date
  totalUsers         Int      @default(0) @map("total_users")
  activeUsers        Int      @default(0) @map("active_users")
  newUsers           Int      @default(0) @map("new_users")
  totalViews         Int      @default(0) @map("total_views")
  totalWatchTime     Int      @default(0) @map("total_watch_time") // seconds
  avgSessionDuration Int      @default(0) @map("avg_session_duration") // seconds
  topContent         Json?    @map("top_content") // [{contentId, views, watchTime}]
  topCategories      Json?    @map("top_categories")
  createdAt          DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([date], map: "idx_daily_stats_date")
  @@map("daily_stats")
}

model Affiliate {
  id             String     @id @default(cuid())
  userId         String     @unique @map("user_id") @db.Uuid
  code           String     @unique
  status         String     @default("pending") // pending, approved, suspended
  commissionRate Decimal    @default(10) @map("commission_rate") @db.Decimal(5, 2) // percentage
  totalReferrals Int        @default(0) @map("total_referrals")
  totalEarnings  Decimal    @default(0) @map("total_earnings") @db.Decimal(10, 2)
  pendingPayout  Decimal    @default(0) @map("pending_payout") @db.Decimal(10, 2)
  createdAt      DateTime   @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime   @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  referrals      Referral[]

  @@index([code], map: "idx_affiliates_code")
  @@index([status], map: "idx_affiliates_status")
  @@map("affiliates")
}

model Referral {
  id               String    @id @default(cuid())
  affiliateId      String    @map("affiliate_id")
  referredUserId   String    @map("referred_user_id") @db.Uuid
  status           String    @default("pending") // pending, converted, paid
  commissionAmount Decimal?  @map("commission_amount") @db.Decimal(10, 2)
  conversionDate   DateTime? @map("conversion_date") @db.Timestamp(6)
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  affiliate        Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  referredUser     User      @relation(fields: [referredUserId], references: [id], onDelete: Cascade)

  @@index([affiliateId, status], map: "idx_referrals_affiliate_status")
  @@index([referredUserId], map: "idx_referrals_referred_user")
  @@index([status], map: "idx_referrals_status")
  @@map("referrals")
}

model EmailQueue {
  id        String    @id @default(cuid())
  to        String
  subject   String
  template  String
  data      Json
  status    String    @default("pending") // pending, sent, failed
  sentAt    DateTime? @map("sent_at") @db.Timestamp(6)
  error     String?
  attempts  Int       @default(0)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([status, createdAt], map: "idx_email_queue_status_created")
  @@index([to], map: "idx_email_queue_to")
  @@map("email_queue")
}

model NotificationPreferences {
  userId          String   @unique @map("user_id") @db.Uuid
  email           Json     @default("{\"newUpload\": true, \"likes\": true, \"comments\": true, \"tips\": true, \"milestones\": true, \"system\": true}")
  push            Json     @default("{\"newUpload\": true, \"likes\": true, \"comments\": true, \"tips\": true, \"milestones\": true, \"system\": true}")
  inApp           Json     @default("{\"newUpload\": true, \"likes\": true, \"comments\": true, \"tips\": true, \"milestones\": true, \"system\": true}")
  frequency       String   @default("instant") // instant, daily, weekly, never
  unsubscribedAll Boolean  @default(false) @map("unsubscribed_all")
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}

model PushSubscription {
  id        String   @id @default(cuid())
  userId    String   @map("user_id") @db.Uuid
  endpoint  String
  keys      Json // { p256dh, auth }
  userAgent String?  @map("user_agent")
  device    String?
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, endpoint], map: "push_subscriptions_user_endpoint")
  @@index([userId], map: "idx_push_subscriptions_user")
  @@map("push_subscriptions")
}

model Feedback {
  id         String   @id @default(cuid())
  userId     String?  @map("user_id") @db.Uuid
  type       String // bug_report, feature_request, general_feedback
  message    String   @db.Text
  screenshot String? // URL to uploaded screenshot
  url        String? // URL where feedback was submitted
  userAgent  String?  @map("user_agent")
  status     String   @default("new") // new, in_progress, resolved, won't_fix
  metadata   Json? // Additional context (browser, device, etc.)
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user       User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId, createdAt], map: "idx_feedback_user_created")
  @@index([status, createdAt], map: "idx_feedback_status_created")
  @@index([type, createdAt], map: "idx_feedback_type_created")
  @@map("feedback")
}

model Experiment {
  id          String                 @id @default(cuid())
  name        String
  description String?
  hypothesis  String
  variants    Json // [{name: 'control', weight: 50}, {name: 'variant_a', weight: 50}]
  metrics     Json // ['conversion_rate', 'watch_time', 'retention']
  status      String                 @default("draft") // draft, running, paused, completed
  startDate   DateTime?              @map("start_date") @db.Timestamp(6)
  endDate     DateTime?              @map("end_date") @db.Timestamp(6)
  results     Json?
  winner      String?
  createdAt   DateTime               @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime               @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  assignments ExperimentAssignment[]

  @@index([status], map: "idx_experiments_status")
  @@index([createdAt], map: "idx_experiments_created_at")
  @@map("experiments")
}

model ExperimentAssignment {
  userId       String     @map("user_id") @db.Uuid
  experimentId String     @map("experiment_id")
  variant      String
  assignedAt   DateTime   @default(now()) @map("assigned_at") @db.Timestamp(6)
  experiment   Experiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)

  @@unique([userId, experimentId], map: "experiment_assignments_user_experiment_unique")
  @@index([userId], map: "idx_experiment_assignments_user")
  @@index([experimentId], map: "idx_experiment_assignments_experiment")
  @@index([variant], map: "idx_experiment_assignments_variant")
  @@map("experiment_assignments")
}

model FeatureFlag {
  key               String   @id
  name              String
  description       String?
  enabled           Boolean  @default(false)
  rolloutPercentage Int      @default(0) // 0-100
  targetUsers       String[] @default([]) // Specific user IDs
  targetRoles       String[] @default([]) // User roles
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([enabled], map: "idx_feature_flags_enabled")
  @@index([key], map: "idx_feature_flags_key")
  @@map("feature_flags")
}

model SavedSearch {
  id          String   @id @default(cuid())
  userId      String   @map("user_id") @db.Uuid
  query       String
  filters     Json     @default("{}")
  name        String?
  notifyOnNew Boolean  @default(false) @map("notify_on_new")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_saved_searches_user")
  @@index([userId, createdAt], map: "idx_saved_searches_user_created")
  @@map("saved_searches")
}

model SearchHistory {
  id            String   @id @default(cuid())
  userId        String?  @map("user_id") @db.Uuid
  sessionId     String   @map("session_id")
  query         String
  resultsCount  Int      @default(0) @map("results_count")
  clickedResult String?  @map("clicked_result") @db.Uuid
  timeToClick   Int?     @map("time_to_click") // milliseconds
  filters       Json     @default("{}")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  user          User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId, createdAt], map: "idx_search_history_user_created")
  @@index([sessionId], map: "idx_search_history_session")
  @@index([query], map: "idx_search_history_query")
  @@index([createdAt], map: "idx_search_history_created")
  @@map("search_history")
}

model Tip {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  from_user_id  String   @db.Uuid
  to_creator_id String   @db.Uuid
  amount        Decimal  @db.Decimal(10, 2)
  currency      String   @default("INR")
  message       String?
  is_anonymous  Boolean  @default(false)
  status        String   @default("pending") // pending, completed, failed, refunded
  transaction_id String?
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  from_user    User     @relation("TipsGiven", fields: [from_user_id], references: [id], onDelete: Cascade)
  to_creator   Creator  @relation(fields: [to_creator_id], references: [id], onDelete: Cascade)

  @@index([from_user_id], map: "idx_tips_from_user")
  @@index([to_creator_id], map: "idx_tips_to_creator")
  @@index([status], map: "idx_tips_status")
  @@index([createdAt], map: "idx_tips_created")
  @@map("tips")
}
